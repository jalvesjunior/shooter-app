<html ng-app="shooterApp">

<head>
	<title>Shooter Game</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/angular.js"></script>	
	<script type="text/javascript" src="js/angular-locale_pt-br.js"></script>
	<script>
		var app = angular.module("shooterApp", []);

		app.controller("jogadorCtrl", function($scope, $http) {

			var url = "http://localhost:8081/shooter-service/rs/jogador";
			var init = function() {
				$http.get(url)
					.success(function(jogadores) {
						$scope.jogadores = jogadores;
					})
					.error(function(errorMessage) {
						console.log("erro ao consumir servico [" + url + "]. Erro: " + errorMessage);
					});
			};
			init();

			/*$scope.jogadores = [
			{id: "1", nome: "diego henrique", apelido: "diegohsi", dataNascimento: "10/10/1980", email: "diegohsi@gmail.com", senha: "123456"}
			,{id: "2", nome: "Maria joana", apelido: "joaninha", dataNascimento: "11/10/1980", email: "joaninha@gmail.com", senha: "123456"}
			,{id: "3", nome: "Paulo Henrique", apelido: "PauloX", dataNascimento: "12/10/1980", email: "paulox@gmail.com", senha: "123456"}
			,{id: "4", nome: "Jorge jose", apelido: "Varjão", dataNascimento: "13/10/1980", email: "varjao@gmail.com", senha: "123456"}
			,{id: "5", nome: "Tereza Silva", apelido: "Terezinha", dataNascimento: "14/10/1980", email: "terezinha@gmail.com", senha: "123456"}
			];
			*/
			$scope.salvarJogador = function(jogador) {
				var isPOST = jogador.id == null;
				if(isPOST) {
					$http.post(url, jogador).then(function(response) {
						autalizarGridCallback(jogador);
					}, function(responseError) {
						errorServiceCallback(responseError);
					});
				} else {
					$http.put(url, jogador).then(function(response) {
						autalizarGridCallback(jogador);
					}, function(responseError) {
						errorServiceCallback(responseError);
					});
				}
				$('#finalizadoModal').modal('show');
				$scope.limparForm();
			}

			$scope.limparForm = function () {
				console.log("limparForm");
				delete $scope.jogador;
				delete $scope.jogadorSelecionado;
			}
			
			var autalizarGridCallback = function(jogador) {
				var jogadorFound = $scope.jogadores.filter(function(item) {
					return item.id == jogador.id;
				});

				var selectedIndex = $scope.jogadores.indexOf(jogadorFound[0]);
				if(selectedIndex < 0) {
					$scope.jogadores.push(angular.copy(jogador));
					return;
				}
				// atualizando a grid
				$scope.jogadores[selectedIndex] = jogador;
				delete $scope.jogadorSelecionado;
				$scope.actionMessage = "Salvo";
			}

			var errorServiceCallback = function(data) {
				console.log("Erro ao executar servico: " + data);
			}
			

			$scope.editarJogador = function(jogador) {
				jogador.dataNascimento = convertDateBr(jogador.dataNascimento);
				$scope.jogadorSelecionado = angular.copy(jogador);
				delete jogador;
			}

			$scope.showModalRemoverJogador = function(jogador) {
				$scope.jogadorSelecionadoExclusao = jogador;
				$('#removerJogadorModal').modal('show');
			}

			$scope.removerJogador = function(jogador) {
				$http.delete(url + "/" + jogador.id).then(
			       function(response) {
			       		var selectedIndex = $scope.jogadores.indexOf(jogador);
						$scope.jogadores.splice(selectedIndex, 1);
						$('#removerJogadorModal').modal('hide');

						$scope.actionMessage = "Removido";
						
						$('#finalizadoModal').modal('show');
			       }, 
			       function(response){
			       		console.log("removido com ERRO: " + response);
			       }
			    );
			}

			var convertDateBr = function(data) {
				var date = data.toString().split("/");
				var correctDate = date[2] + "/" + date[1] + "/" + date[0];
				return new Date(correctDate);
			}
		});
	</script>
</head>

<body ng-controller="jogadorCtrl">
	<div class="na, $httpvbar navbar-default navbar-static-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-ex-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#"><span>Brand</span></a>
			</div>
			<div class="collapse navbar-collapse" id="navbar-ex-collapse">
				<ul class="nav navbar-nav navbar-right">
					<li class="active">
						<a href="#">Home</a>
					</li>
					<li>
						<a href="#">Contacts</a>
					</li>
				</div>
			</div>
		</div>
		<div class="section">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
						<ul class="nav nav-pills">
							<li class="active">
								<a href="#">Home</a>
							</li>
							<li>
								<a href="#">Profile</a>
							</li>
							<li>
								<a href="#">Messages</a>
							</li>
						</ul>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<h3>Cadastro de jogador</h3>
					</div>
				</div>
				<hr>
				<div class="row">
					<div class="col-md-6">
						<form role="form" name="jogadorForm">
							<div class="form-group">
								<label class="control-label" for="exampleInputEmail1">Nome e sobrenome</label>
								<input class="form-control" id="exampleInputEmail1" placeholder="Digite o nome" type="text" ng-model="jogadorSelecionado.nome" ng-required="true">
							</div>
							<div class="form-group">
								<label class="control-label" for="exampleInputEmail1">Apelido</label>
								<input class="form-control" id="exampleInputEmail1" placeholder="Digite o apelido" type="text" ng-model="jogadorSelecionado.apelido" ng-required="true">
							</div>
							<div class="form-group">
								<label class="control-label" for="exampleInputEmail1">Data de nascimento</label>
								<input class="form-control" id="exampleInputEmail1" type="date" ng-model="jogadorSelecionado.dataNascimento" >
							</div>
							<div class="form-group">
								<label class="control-label" for="exampleInputEmail1">Email</label>
								<input class="form-control" id="exampleInputEmail1" placeholder="Digite o email" type="email" ng-model="jogadorSelecionado.email" ng-required="true">
							</div>
							<div class="form-group">
								<label class="control-label" for="exampleInputPassword1">Senha</label>
								<input class="form-control" id="exampleInputPassword1" placeholder="Digite a senha" type="password" ng-model="jogadorSelecionado.senha" ng-required="true">
							</div>
							<button type="button" class="btn btn-warning" ng-click="limparForm()">Limpar</button>
							<button type="submit" class="btn btn-success" ng-click="salvarJogador(jogadorSelecionado)" ng-disabled="jogadorForm.$invalid">Salvar</button>
						</form>
					</div>
					<div class="col-md-6"></div>
				</div>
				<hr>
				<div class="row">
					<div class="col-md-12">
						<table class="table table-hover table-striped">
							<thead>
								<tr>
									<th>#</th>
									<th>Nome</th>
									<th>Data nascimento</th>
									<th>Apelido</th>
									<th>email</th>
									<th></th>
								</tr>
							</thead>
							<tbody >
								<tr ng-repeat="jogador in jogadores">
									<td>{{jogador.id}}</td>
									<td>{{jogador.nome}}</td>
									<td>{{jogador.dataNascimento | date:'dd/MM/yyyy'}}</td>
									<td>{{jogador.apelido}}</td>
									<td>{{jogador.email}}</td>
									<td>
										<button type="button" class="btn btn-warning" ng-click="editarJogador(jogador)">
											<span class="glyphicon glyphicon-pencil"></span>
										</button>
										<button type="button" class="btn btn-danger" ng-click="showModalRemoverJogador(jogador)" data-toggle="modal">
											<span class="glyphicon glyphicon-remove"></span>
										</button>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

		<div id="removerJogadorModal" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">Excluir Jogador</h4>
					</div>
					<div class="modal-body">
						<p>Confirme a exclusão do jogador: <b>{{jogadorSelecionadoExclusao.nome}}</b>, <b>{{jogadorSelecionadoExclusao.email}}</b></p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">cancelar</button>
						<button type="button" class="btn btn-danger" ng-click="removerJogador(jogadorSelecionadoExclusao)">Confirmar</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div>

		<div id="finalizadoModal" class="modal fade" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					</div>
					<div class="modal-body">
						<div class="alert alert-success" role="alert">
						  <p><b>{{actionMessage}}</b> com sucesso.</p>
						</div>
						
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div>

		<footer class="section section-primary text-center">
			<div class="container text-center">
				<h1>Developed by Arrow Black</h1>
			</div>
		</footer>
	</body>
	</html>
